<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Paul &middot; tag line
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Paul
        </a>
      </h1>
      <a href="https://twitter.com/pauldotknopf" target="_blank">@pauldotknopf</a>
      <p class="lead">Random thoughts and ideas of a software developer.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
          
        
      
        
      
        
      

    </nav>

    <p>&copy; 2016. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
  <h1 class="post-title">
    <a href="/development/2013/03/07/Performance-CPP-CLI-vs-COM/">
      Performance: C++/CLI vs COM
    </a>
  </h1>
  

<div class="post-links">
  <span class="post-date"><i class="fa fa-calendar-o fa-1" aria-hidden="true"></i> 07 Mar 2013</span>
  <span class="post-edit"><i class="fa fa-pencil-square-o fa-1" aria-hidden="true"></i> 

<a href="https://github.com/pauldotknopf/pauldotknopf.github.io/edit/master/blog/_posts/2013-03-07-Performance-CPP-CLI-vs-COM.md">edit</a>
</span>
  



<span class="post-comments"><i class="fa fa-comment-o fa-1" aria-hidden="true"></i> <a href="/development/2013/03/07/Performance-CPP-CLI-vs-COM/#disqus_thread" data-disqus-identifier="post-1053">comments</a></span>

</div>

  <p>In my current project, we are going to require a great deal of native code due to interation with drivers and hardware. The application is going to be based in .NET, at least the UI portion, but the heart has to live in native C++.</p>

<p>I began investigating different ways to interop with .NET and unmanaged code. There seems to be three approaches.</p>

<ol>
  <li>PInvoke</li>
  <li>COM/COM+/Interop</li>
  <li>C++/CLI</li>
</ol>

<p>I did not look into the PInvoke method because I know that it will not be suitable for my needs. Things get complicated really quick with PInvoke. It is ideal for small/quick access to Win32, but not beyond that. With that said, I produced some metrics about the performance between COM+ and C++/CLI.</p>

<p>I have one class (unmanaged) that I use in every metric.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#pragma once
</span><span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="k">class</span> <span class="nc">NativeClass</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
	<span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">NativeClass</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="o">~</span><span class="n">NativeClass</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="kt">int</span> <span class="n">GetWindowsVersion</span><span class="p">(</span><span class="kt">int</span> <span class="n">numberOfExecutions</span><span class="p">);</span>
<span class="p">};</span></code></pre></figure>

<p>There are duplications of this class but they all do the same thing. The method we are testing is a simple GetVersionEx from the WinAPI.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="kt">int</span> <span class="n">NativeClass</span><span class="o">::</span><span class="n">GetWindowsVersion</span><span class="p">(</span><span class="kt">int</span> <span class="n">numberOfExecutions</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">OSVERSIONINFO</span> <span class="n">osvi</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">numberOfExecutions</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ZeroMemory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">osvi</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">OSVERSIONINFO</span><span class="p">));</span>
		<span class="n">osvi</span><span class="p">.</span><span class="n">dwOSVersionInfoSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">OSVERSIONINFO</span><span class="p">);</span>
		<span class="n">GetVersionEx</span><span class="p">(</span><span class="o">&amp;</span><span class="n">osvi</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">osvi</span><span class="p">.</span><span class="n">dwBuildNumber</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The parameter “numberOfExecutions” tells the unmanaged class how many times it should invoke GetVersionEx. This native class is written/duplicated in multiple projects to similate the same process. I have 4 projects.</p>

<ol>
  <li>PerformanceTest - This is a console application that runs the performance in C#/.NET</li>
  <li>CLITest - This is a C++/CLI project that contains two classes.
The first class is a wrapper around an unmanaged class that is compiled in the same C++/CLI project.
The second class is a wrapper around an unmanaged class that is compiled in a seperate native dll (not C++/CLI).</li>
  <li>COMTest - This is a project that has a COM wrapper around an unmanaged class.</li>
</ol>

<p>I tested two scenarios.</p>

<ol>
  <li>Calling an unmanaged class from .NET multiple times.</li>
  <li>Calling an unmanaged class from .NET a single time while doing a large task (numberOfExecutions = 10000000).</li>
</ol>

<p>Here are the results from the console application for the 3 situations.</p>

<ol>
  <li>.NET to CLI calling an unmanaged class compiled in C++/CLI.</li>
  <li>.NET to CLI calling an unmanaged class compiled in native C++.</li>
  <li>.NET to COM calling an unmanaged class compiled in native C++.</li>
</ol>

<p>Here is the output of the test.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>CLI..........................
     GetWindowsVersion:
         Calls: 100000
         Executions: 1
         Result: 00:00:00.0190000
     GetWindowsVersion:
         Calls: 1
         Executions: 100000000
         Result: 00:00:15.7790000
CLI to native................
     GetWindowsVersion:
         Calls: 100000
         Executions: 1
         Result: 00:00:00.0180000
     GetWindowsVersion:
         Calls: 1
         Executions: 100000000
         Result: 00:00:04.8020000
COM..........................
     GetWindowsVersion:
         Calls: 100000
         Executions: 1
         Result: 00:00:02.6120000
     GetWindowsVersion:
         Calls: 1
         Executions: 100000000
         Result: 00:00:04.7310000
</code></pre>
</div>

<h2 id="conclusion">Conclusion</h2>

<p>Native code compiled and running under C++/CLI is a great deal slower than running pure native code. COM would be the obviouse choice due to it running pure unmanaged code, but C++/CLI can give the same performance if used as a wrapper around a pure native assembly. In addition, COM/ATL is very difficult to learn, however, Visual Studio’s class wizards make it easier. Also, it seems that, making a great deal of calls to native code is MUCH more efficient through C++/CLI as opposed to COM, but this may be an unlikely scenario. Given these results and given the fact that this native code I am writing will be written primarily for .NET (as opposed to COM/activex/etc), I would recommend using the C++/CLI wrapper approach. Same performance, more flexible interop.</p>

<p>The project used for running these tests can be found on github <a href="https://github.com/theonlylawislove/CLICOMPerformanceTest">here</a>.</p>

</div>

  
  <div class="post">
  <h1 class="post-title">
    <a href="/development/2013/01/26/why-you-should-avoid-ektron/">
      Why you should avoid Ektron
    </a>
  </h1>
  

<div class="post-links">
  <span class="post-date"><i class="fa fa-calendar-o fa-1" aria-hidden="true"></i> 26 Jan 2013</span>
  <span class="post-edit"><i class="fa fa-pencil-square-o fa-1" aria-hidden="true"></i> 

<a href="https://github.com/pauldotknopf/pauldotknopf.github.io/edit/master/blog/_posts/2013-01-26-why-you-should-avoid-ektron.md">edit</a>
</span>
  



<span class="post-comments"><i class="fa fa-comment-o fa-1" aria-hidden="true"></i> <a href="/development/2013/01/26/why-you-should-avoid-ektron/#disqus_thread" data-disqus-identifier="post-1052">comments</a></span>

</div>

  <p><strong>The first Ektron project I worked on</strong>, I had no experience with it. I am a very quick learner and dive into new things head first, so I gave Ektron and honest chance. After setting Ektron up out of the box, <strong>I immediately started feeling uncomfortable</strong>. The first thing I noticed were the tables.</p>

<p><img src="/images/ektron_tables.jpg" alt="Alt text" /></p>

<p>This immediately gave me the feeling that there are separate divisions within Ektron that live by their own rules, sorta like the wild west. “Maybe this will be the extent of my discomfort.” I told my self. Then, I saw that the product was a <strong>mix of C#/VB</strong>. This goes <strong>against best practices</strong>, especially since the code in each language serves the same problem domain! <strong>Edit</strong>: <em>Latest release now includes only C#.</em></p>

<p>In addition, the product <strong>only supports websites (not web applications)</strong>. You will be hard-pressed to find any website now-a-days (excluding Ekton websites) that still use the website project template. This has introduced many pain points. For one, you are unable to “exclude” the Workarea from Visual Studio. This is a problem because the workarea is very large. It <strong>ruins the performance of Visual Studio</strong> due to intellisense namespace/object caching because Visual Studio has to inspect that directory. People have suggested “hiding” the workarea and a filesystem level, but this doesn’t work in development due to widgets referencing user contols that exist in the workarea (which can’t be located). Also, websites don’t work well with a build process of any kind. It increased my build times on TFS to almost 30 minutes! There are some workarounds, but none that don’t involve re-deploying the workarea every time (which is very large). Their latest versions claim to support web applications, but there is no template provided. You must use the “Convert to web application” command in visual studio. There is stil the problem of uncompiled source code that shouldn’t be built/available in implementations. At my last company, I wanted to have everything compiled in my implementation. So, I decided to publish the website, perform an aspnet_merge to create one (very big) EktronWeb.dll, and add the output to my implementation. I was notified by support that the solution would be unsupported. That is ridiculous to so say that a published version of your website (which is essentially what I had) would be unsupported. That is like saying you do not support any deployed instances of Ektron! I was forced to waste a great deal of time building/deploying. Long story short, <strong>web applications are the way to go and avoid any project that is a website (including Ektron)</strong>. Ektron is the only CMS I have seen that uses a website project template. There are good reasons for this Ektron! Take note!</p>

<p>Also, the <strong>usability of Ektron is horrible</strong>. They almost refuse to adhere to any kind of UI/layout/style standard. This leads to a large amount of HTML/CSS that is required to style forms that adhere to their own standards (or lack thereof). It also forces the end users to constantly rethink what is going on in each area/page, therefore, ruining usability.</p>

<p>The use of <strong>XML/XLST is largely outdated</strong> and Ektron insists on being centered around this idea. Their SmartForm is very unusable in real world situations. It is entirely xml based and <strong>corrupts very easily</strong>. Support recommended that I remove each field 1-by-1 to determine what was corrupting it, which is unacceptable. You cannot change the smartform after content has already been applied to it. Collections cannot be reordered without running the <strong>risk of losing content</strong>. Working with the data that the smartform generates (in xml) is also verify difficult, however, recent versions have allowed you to map the xml to a .NET object. Also, since that database stores the content in one huge xml field (that isn’t even an xml data type), it is almost <strong>impossible to query smartforms based on criteria</strong> without loading all the items in memory. I saw somewhere that they support linq, but further investigation revealed that they support linq-to-objects that are in memory. This is a out-of-the-box .NET feature, not an Ektron feature! They recently introduced support for criteria seaching, but it is still unacceptable, due to the fact you can only query standard fields in Ektron. This is not valid in the real world due to most implementations will want to filter/sort based on custom fields specific to the implementation.</p>

<p>The editor for Ektron insists (no way around it) on putting ‘&amp;#160’ everywhere which makes css break and html bloated. Developers are forced to add .Replace(“&amp;#160”,””); everywhere, which is also unacceptable. <strong>Edit</strong>: <em>The latest version has a new editor which doesn’t do this.</em></p>

<p>Also, <strong>MVC will never be supported</strong>. I have made MVC work inside of Ektron, but Ektron itself will never be centered around the pattern. This is a feature I like to see in the products I choose. Now, I can’t really say for certain they will never support it, but given what I know about how page builder, embedded widgets and the workarea, it is a safe bet to assume so. A rewrite is needed (for more than 1 reason).</p>

<p>Every CMS has support for building custom forms, but <strong>Ektron’s “HTML Forms/Surveys” is not for the standard business user</strong>. It requires an advanced knowledge of XHTML. My client needed to build custom forms, but they weren’t a web dev shop, so they <strong>couldn’t use the feature</strong>. Unless, of course, they paid $180 an hour for my previous job’s time. They were extremely upset with it. Yet another Ektron site that the client later regrets. I will say it again, Ektron must move from being XML centered.</p>

<p>The Ektron API’s are <strong>unusable from non-web applications</strong> which make <strong>one-off tasks</strong> impossible without the use of hand-crafted ADO.NET code.</p>

<p>Ektron also uses many 3rd party libraries, but they refuse to keep them updated, which forces implementors to <strong>use outdated libraries</strong>. My project required the latest version of Netwon’s JSON.NET, but Ektron had a very outdated version of it in use. I was force to download JSON.NET, add a wrapper namespace and rename the assembly to avoid <strong>breaking Ektron</strong> (which the new version did). This is unacceptable Ektron. Before each release, you should ensure all 3rd party libraries are up to date.</p>

<p>Long story short, I was forced into many situations where I had to <strong>explain to my clients that things were not possible</strong>. For example, I had to tell a client that they couldn’t generate a sitemap for google. There response was an awkward “Well, that is a standard feature of CMS system.” I was inclined to agree and was <strong>forced to defend a product that I strongly oppose</strong>.</p>

<p>After my experiences with Ektron, I realized that I am <a href="http://www.realstorygroup.com/Blog/2370-Is-Ektron-headed-up-or-down%20">not</a> <a href="https://twitter.com/GoJaime/status/73437199873482753%20">the</a> <a href="https://twitter.com/ajryan6of7/status/55804229457158144">only</a> <a href="https://twitter.com/arcware/status/51309851883741184">one</a>. Sure, every product will have its naysayers, but I believe (<a href="http://www.hiprank.com/dotnetnuke-vs-ektron-vs-kentico-vs-sitecore-vs-sitefinity.html">as</a> <a href="http://www.glassdoor.com/Reviews/Ektron-Reviews-E33092.htm%20">well</a> <a href="http://amplicate.com/hate/ektron">as</a> <a href="http://www.webdeveloper.com/forum/showthread.php?148354-Anyone-else-hate-Ektron-Any-hope-for-it">others</a>) that there is an <strong>alarming amount of negative press surrounding Ektron</strong>. Ektron must shift its focus from developing features to improving that architecture of Ektron, which I don’t think is possible without doing a complete rewrite. It is unfortunate that they do infact have a great marketing/sales team because they are <strong>polluting the CMS industry with a horrible product</strong>. Clients must stop assuming that “This product is expensive, so it MUST be good!” Have your software architects review the product before shelling out a great deal of money for licenses/support!</p>

</div>

  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


    </div>

    <script id="dsq-count-scr" src="//pknopf.disqus.com/count.js" async></script>
    <script>
	  	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  		ga('create', 'UA-33707123-1', 'auto');ga('send', 'pageview');
	  </script>
  </body>
</html>
